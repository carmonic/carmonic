<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mechanic</title>
</head>
<body>
<!-- Load socket.io client library -->
<script src="/socket.io/socket.io.js"></script>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="http://malsup.github.com/jquery.form.js"></script>

<script type="text/javascript">
    var socket = io.connect();
    socket.on('connect', function () {
        console.log('Mechanic has connected to the server!');
        $('#online').text("Online");
    });
    socket.on('disconnect', function () {
        console.log('Mechanic has disconnected from the server!');
        $('#online').text("Offline");
    });
    socket.on('job_request', function (mechanic, customer) {
        console.log('Mechanic has received a job from ' + customer.id);

        var newdiv = document.createElement("div");
        newdiv.setAttribute("id", "jobContainer");

        var p = document.createElement("p");
        p.innerHTML = "You have received a job from " + customer.firstname + ' ' + customer.lastname;

        var acceptButton = document.createElement("button");
        acceptButton.setAttribute("id", "acceptJob");
        acceptButton.innerHTML = "Accept";

        var rejectButton = document.createElement("button");
        rejectButton.setAttribute("id", "rejectJob");
        rejectButton.innerHTML = "Reject";

        newdiv.appendChild(p);
        newdiv.appendChild(acceptButton);
        newdiv.appendChild(rejectButton);

        $('#notifications').prepend(newdiv);

        $('#acceptJob').click(function () {
            socket.emit('mechanic_accept_job', mechanic, customer);
            $('#jobContainer').remove();

        });
        $('#rejectJob').click(function () {
            socket.emit('mechanic_reject_job', mechanic, customer);
            $('#jobContainer').remove();

        });
    });
    $(document).ready(function () {

        $('#jobContainer').hide();

        $('#signupForm').ajaxForm({
            success: function (response) {
                console.log(response);
                var newdiv = document.createElement("p");
                newdiv.innerHTML = response.authInfo.message;
                $('#notifications').prepend(newdiv);
            }
        });

        $('#loginForm').ajaxForm({
            success: function (response) {
                console.log(response);
                var newdiv = document.createElement("p");
                newdiv.innerHTML = response.authInfo.message;
                $('#notifications').prepend(newdiv);
                authToken = response.user.token;

                var mechanic = response.user;
                socket.emit('mechanic_register', mechanic);
                console.log("Mechanic has registered");
            }
        });

        $('#deleteForm').ajaxForm({
            success: function (response) {
                console.log(response);
                var newdiv = document.createElement("p");
                newdiv.innerHTML = response.authInfo.message;
                $('#notifications').prepend(newdiv);
            }
        });


    });
</script>
<div>
    <h1>Welcome to Carmonic for Mechanics</h1>
    <p id="online"><b></b></p>
</div>
<div style="width: 100%; overflow: hidden;">
    <div style="width: 50%; float: left;">
        <div>
            <h4>Step 1: Create a new account</h4>
            <form id="signupForm" action="/signupMechanic" method="post">
                Name:<br>
                <input type="text" name="name"><br>
                Latitude:<br>
                <input type="text" name="latitude"><br>
                Longitude:<br>
                <input type="text" name="longitude"><br>
                Phone Number:<br>
                <input type="text" name="phoneNumber"><br>
                <input type="submit" value="Sign Up"/>
            </form>
        </div>
        <div>
            <h4>Step 2: Sign In</h4>
            <form id="loginForm" action="/loginMechanic" method="post">
                Name:<br>
                <input type="text" name="name"><br>
                Phone Number:<br>
                <input type="text" name="phoneNumber"><br>
                <input type="submit" value="Login"/>
            </form>
        </div>
        <div>
            <h4>Step 3: Upon receiving customer request, accept or reject</h4>
        </div>
        <div>
            <h4>Step 4: Delete the account you created</h4>
            <form id="deleteForm" action="/deleteMechanic" method="post">
                <div>
                    <label>Name:</label>
                    <input type="text" name="name"/><br/>
                </div>
                <div>
                    <label>Phone Number:</label>
                    <input type="text" name="phoneNumber"/><br/>
                </div>
                <div>
                    <input type="submit" value="Delete"/>
                </div>
            </form>
        </div>
    </div>
    <div style="margin-left: 58%;">
        <p><b>Notifications</b></p>
        <div id="notifications">

        </div>
    </div>
</div>
<div id="map">
    <!-- We will load a map here later-->
</div>
</body>
</html>